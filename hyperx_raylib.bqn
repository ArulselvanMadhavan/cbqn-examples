âŸ¨âŸ¨red, green, white, blackâŸ©â‡color, raylibâŸ©â†râ†â€¢Import "../rayed-bqn/rayed.bqn"
recâ†20
spacing â† 70
ctrlPtX â† 100
ctrlPtY â† 100
dims â† 7â€¿7
nd â† â‰ dims
dims_xy â† dims âˆ¾ 2
gridâ†spacing + (rec+spacing)Ã—>â¥Šâ†•dims
r.window.SetSize 0.5

AddCtrlPts â†{dim_idğ•Š[x1â€¿y1â‹„x2â€¿y2]:
  ctrlOffsets â† [[(5Ã·ctrlPtX)â€¿0, (Â¯1Ã—ctrlPtX)â€¿0], [(0â€¿(5 Ã· ctrlPtY)), (0â€¿(Â¯1Ã—ctrlPtY))]]
  ctrlOffset â† dim_idâŠctrlOffsets
  plus â† 0âŠctrlOffset
  sub â† 1âŠctrlOffset
  res â† (âˆ¾âŸœ((+âŸœplus)â‰(subâŠ¸+)))Ë˜ ğ•©
  # Convert mxnxk - (mxn)xk and then convert rank 2 array to list of lists
  <â¥Šâˆ˜(â‹ˆâ‰(Â¯1))âˆ˜âˆ¾â‹ˆâ‰Â¯1 res
}

DrawBezier â† {râ€¿gâ€¿bâ€¿ağ•Špts:
    args â† ptsâˆ¾4âˆ¾2.0â‹ˆğ•¨
    raylib.DrawSplineBezierCubic args
}â‰1â€¿2

GenOff â† {ğ•Šğ•©:
      midtp â† ğ•©
      lastDim â† 1â†“â†•(Â¯2âŠ¸âŠ‘â‰¢) midtp
      rotations â† {(ğ•©âŠ¸âŒ½)â‰2 midtp}Â¨ lastDim
      {midtp â‰â‰1 ğ•©}Â¨ rotations
  }

PerFrame â† {ğ•¤
    pos â† r.mouse.GetPos@
    ellipseGrid â† {â‰âŸœ(+âŸœrec)}Ë˜ grid
    {white r.draw.EllipseOutline ğ•©}Ë˜ ellipseGrid
    midpts â† Ã·âŸœ2âˆ˜+Ëâ‰2 ellipseGrid
    midpts_xy â† dims_xy â¥Š midpts
    axisRots â† ((â†•â‰ dims)âŠ¸(âŒ½Ëœ))Â¨ â†•â‰ dims
    offsets â† (GenOffâˆ˜(midptsxyâŠ¸(â‰Ëœ)))Â¨ axisRots
    # offsets - dims x rots_per_dim x dim_1 x dim_n x 2
    flags â† (âŒ½âˆ˜â†•nd) {(ğ•¨âŠ¸âŠ‘âˆ˜<Ëâ‰2)Â¨ğ•©}Â¨ offsets
    # flags - dims x rots_per_dim x dim_1 x dim_2
    curves â† flags (/Ë˜)Â¨Â¨ offsets
    curvePts â† (â†•nd) {ğ•¨âŠ¸AddCtrlPtsË˜Ë˜Â¨ ğ•©}Â¨ curves
    {red DrawBezier ğ•©}Ë˜Ë˜Â¨Â¨ curvePts
} r.draw._withCanvasâŸœblack

PerFrameâ€¢_While_(Â¬r.window.ShouldClose)r.window._openAs "HyperX"
