* Toposim utilities
#+begin_src bqn
  Mat â† â¥ŠâŸœ(â†•Ã—Â´)
  Enumerate â† (âˆ¾âŒœ)Â´âˆ˜(â†•Â¨)
  Zeros â† â¥ŠâŸœ0
  dims â† 4â€¿4
  dims_enum â† â¥ŠEnumerate dims
  IdToDim â† âŠ‘âˆ˜(/âŸœdims_enum)âˆ˜(â¥Šâˆ˜â·Ëœ)
  switches â† Mat dims
  GenNeighbors â† {ğ•Šğ•©:
    dim_id â† ğ•©
    InsertDim â† {ğ•¨ğ•Šğ•©:
      ğ•©âŒ¾(ğ•¨âŠ¸âŠ‘) dim_id
    }
    GenDimExclude â† /âˆ˜â‰ âŸœâ†•
    DimVariants â† {ğ•Šğ•©:
      dim_idx â† ğ•©
      dim_lenâ€¿dim_val â† dim_idxâŠ¸âŠ‘Â¨ dimsâ€¿dim_id
      d3 â† dim_val GenDimExclude dim_len
      dim_idx InsertDimÂ¨ d3
    }
    neigh_ids â† âˆ¾DimVariantsÂ¨â†•â‰ dims
    nsâ†dims_enum âŠ¸âŠâŠ¢Â¨ neigh_ids
    1Â¨âŒ¾(âŠËœâŸœns) (Zeros (Ã—Â´ dims))
  }
  result â† GenNeighborsâˆ˜IdToDimËœâŸœswitchesÂ¨ â¥Šswitches
  >result
#+end_src
